#!/usr/bin/env node
'use strict';

const async = require('async');
const util = require('util');
const {fetchGame} = require('../src/fetch');
const {server} = require('../test/analyzer/fixtures');

if (!module.parent) {
  // Fetch info on games/invites between 2 players for now
  const alice = process.argv[2];
  const bob = process.argv[3];
  let error;
  let result;
  let stack = [
    server.start,
    (cb) => fetchGame(alice, bob, (err, ret) => {
      error = err;
      result = ret;
      cb();
    }),
    server.stop
  ];

  // Disable local server for remote `HOST`s.
  if (!server.local)
    stack = stack.slice(1, 2);

  if (!alice || !bob)
    throw new Error('Provide 2 usernames');

  async.series(stack, (err) => {
    process.exitCode = (err || error) ? 1 : 0;
    console.log('\n%s', util.inspect(err || error || result, {depth: 2}));
  });
}
